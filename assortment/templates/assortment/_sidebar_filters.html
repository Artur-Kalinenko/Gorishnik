{% load dict_extras %}

<form method="get" id="filter-form">
    {% if selected_category %}
        <input type="hidden" name="category" value="{{ selected_category }}">
    {% endif %}
    {% if query %}
        <input type="hidden" name="q" value="{{ query }}">
    {% endif %}

    {% if active_producers %}
        <div class="filter-group mb-3">
            <h5 class="filter-header">–í–∏—Ä–æ–±–Ω–∏–∫–∏</h5>
            <div class="d-flex flex-wrap gap-2">
                {% for producer in active_producers %}
                    {% if producer.id|stringformat:"s" in selected_producer_ids %}
                        {% comment %}–í—ã–±—Ä–∞–Ω–Ω—ã–π{% endcomment %}
                        <label class="producer-label producer-label--selected">
                            <input type="checkbox" name="producer" value="{{ producer.id }}"
                                   class="d-none"
                                   checked>
                            <img src="{{ producer.producer_img.url }}"
                                 alt="{{ producer.producer_name }}"
                                 class="producer-img">
                        </label>
                    {% else %}
                        {% comment %}–ù–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–π{% endcomment %}
                        <label class="producer-label">
                            <input type="checkbox" name="producer" value="{{ producer.id }}"
                                   class="d-none">
                            <img src="{{ producer.producer_img.url }}"
                                 alt="{{ producer.producer_name }}"
                                 class="producer-img">
                        </label>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <!-- üîΩ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
    <div class="filter-group mb-3">
        <h5 class="filter-header">–î–æ–¥–∞—Ç–∫–æ–≤–æ</h5>
        <div class="filter-options">
<!--            <div class="form-check mb-1">-->
<!--                <input class="form-check-input" type="checkbox" name="discounted" value="1"-->
<!--                       {% if request.GET.discounted %}checked{% endif %}>-->
<!--                <label class="form-check-label">–ê–∫—Ü—ñ–π–Ω—ñ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó</label>-->
<!--            </div>-->
            <label class="form-check mb-1">
                <input class="form-check-input" type="checkbox" name="new" value="1" {% if request.GET.new %}checked{% endif %}>
                <span class="custom-checkbox"></span>
                <span class="form-check-label">–ù–æ–≤–∏–Ω–∫–∏</span>
            </label>
            {% if user.is_authenticated %}
            <label class="form-check mb-1">
                <input class="form-check-input" type="checkbox" name="my_favorites" value="1" {% if request.GET.my_favorites == "1" %}checked{% endif %}>
                <span class="custom-checkbox"></span>
                <span class="form-check-label">–ú–æ—ó –æ–±—Ä–∞–Ω—ñ —Ç–æ–≤–∞—Ä–∏</span>
            </label>
        {% endif %}

        </div>
    </div>

    <!-- üîΩ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
    {% for group in filter_groups %}
        <div class="filter-group mb-3">
            <h5 class="filter-header d-flex justify-content-between align-items-center"
                data-group-id="{{ group.id }}" style="cursor: pointer;">
                {{ group.name }}
                <span class="toggle-icon" id="icon-{{ group.id }}">+</span>
            </h5>
            <div class="filter-options" id="group-{{ group.id }}" style="display: none;">
                {% for option in group.options.all %}
                    {% with count=option_counts|get_item:option.id %}
                    {% with total=option_total_dict|get_item:option.id %}
                    <label class="form-check mb-1">
                        <input class="form-check-input"
                               type="checkbox"
                               name="filters"
                               value="{{ option.id }}"
                               {% if option.id in selected_filter_ids %}checked{% endif %}>
                        <span class="custom-checkbox"></span>
                        <span class="form-check-label">
                            {{ option.name }}
                            ({% if option.id in selected_filter_ids %}{{ count|default:0 }}{% else %}{{ total|default:0 }}{% endif %})
                        </span>
                    </label>
                    {% endwith %}
                    {% endwith %}
                {% endfor %}
            </div>
        </div>
    {% endfor %}


    <button type="button" id="clear-filters" class="btn btn-outline-danger mt-4">
        –û—á–∏—Å—Ç–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏
    </button>
</form>